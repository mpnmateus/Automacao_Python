from selenium import webdriver
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
import time

#configurar as opções do chrome
chrome_options = Options ()
chrome_options.add_experimental_option("detach", True)  # Manter a janela aberta

# Instalar o driver do Chrome
servico = Service(ChromeDriverManager().install())

# Inicializar o navegador com as opções configuradas
navegador = webdriver.Chrome(service=servico, options=chrome_options)

# Maximizar a janela do navegador
navegador.maximize_window()

# Abrir a página desejada
navegador.get("https://app3.operand.com.br/arquivos")

# Preenchendo dados para login
navegador.find_element('xpath', '//*[@id="email"]').send_keys("financeiro@agenciacondao.com.br")
navegador.find_element('xpath', '//*[@id="password"]').send_keys("Financeiro@2023")

# Clicando em 'Entrar'
navegador.find_element('xpath', '//*[@id="do-login"]').click()

# Esperar a página carregar (ajuste conforme necessário)
time.sleep(5)



# Clicar no botão de filtro
navegador.find_element(By.XPATH, '//*[@id="btn-filtros"]').click()

# Esperar o campo de data ficar visível
time.sleep(2)  # Ajuste o tempo conforme necessário

# Clicar no campo de data para abrir o seletor de datas
navegador.find_element(By.XPATH, '//*[@id="find_date"]').click()

# Esperar o seletor de datas aparecer
time.sleep(2)  # Ajuste o tempo conforme necessário

# Selecionar a opção "Personalizado"
navegador.find_element(By.XPATH, '/html/body/div[5]/div[3]/ul/li[5]').click()

# Esperar o campo de data personalizado ficar visível
time.sleep(2)  # Ajuste o tempo conforme necessário

# Selecionar a data inicial e final (Exemplo: 1º de Maio de 2023 a 31 de Maio de 2023)
# Obs: Dependendo de como o seletor de datas é implementado, você pode precisar ajustar esta parte
navegador.find_element(By.NAME, 'daterangepicker_start').send_keys("01/05/2023")
navegador.find_element(By.NAME, 'daterangepicker_end').send_keys("31/05/2023")

# Clicar no botão "Confirmar"
navegador.find_element(By.XPATH, '//button[@class="applyBtn btn btn-sm btn-success"]').click()

# Esperar a página recarregar com os novos filtros
time.sleep(5)


# Encontrar todos os elementos de arquivos PDF e clicar neles
arquivos_pdf = navegador.find_elements(By.XPATH, '//div[@class="mini-holder other-files pdf"]/..')

for arquivo in arquivos_pdf:
    try:
        # Clicar no link do arquivo PDF
        arquivo.click()
        time.sleep(2)  # Esperar a nova aba carregar
        # Voltar para a aba original
        navegador.switch_to.window(navegador.window_handles[0])
    except Exception as e:
        print(f"Erro ao clicar no arquivo: {e}")

